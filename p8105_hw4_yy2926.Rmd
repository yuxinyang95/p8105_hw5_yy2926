---
title: "Homework4"
author: "Yuxin"
date: "2018.11.6"
output: github_document
---


```{r setup, include=FALSE}
library(tidyverse)
library(stringr)
library(purrr)
```

# Problem 1 

This zip file contains data from a longitudinal study that included a control arm and an experimental arm. Data for each participant is included in a separate file, and file names include the subject ID and arm.

## Quesiton 1

Create a tidy dataframe containing data from all participants, including the subject ID, arm, and observations over time:

* Start with a dataframe containing all file names; the list.files function will help
* Iterate over file names and read in data for each subject using purrr::map and saving the result as a new variable in the dataframe
* Tidy the result; manipulate file names to include control arm and subject ID, make sure weekly observations are “tidy”, and do any other tidying that’s necessary

```{r}
## Write a function to read all data 
file_name = list.files("./data/")
read_function = function(file_name){
 study_data = read_csv(file = str_c("./data/",file_name)) %>%
   mutate(file = file_name)
}

## Use function to read all datasets and tidying the dataframe
study_data = 
  map_df(file_name, read_function) %>%
  gather(key = week, value = observation, week_1:week_8) %>%
  separate(file, into = c("group", "subject"), sep = "_") %>%
  mutate(group = recode(group, con = "control", exp = "experiment"),
         subject = str_remove(subject,".csv"),
          week = str_remove(week, "week_"))
```

## Quesiton 2

Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.

```{r}
ggplot(study_data, aes(x = week, y = observation, group = subject, color = subject))+
  geom_line()+
  facet_grid(.~group)+
  labs(title = "Observations over time of two different groups")

```